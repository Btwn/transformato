GOGOCREATE PROCEDURE [dbo].[xpValidarAplicacionCXC]@ID INT,@Mov VARCHAR(50),@Ok INT OUTPUTAS BEGINDECLARE@MovID VARCHAR(50),@Aplica VARCHAR(20),@AplicaID VARCHAR(50),@Renglones INT,@Iteracion INTSET @Iteracion=0IF (ISNULL(@Mov,'')='')BEGINSET @Mov=(SELECT Origen FROM Cxc WHERE ID=@ID)SET @MovID=(SELECT OrigenID FROM Cxc WHERE ID=@ID)ENDIF (@Mov IN ('Nota Credito Mayoreo','Nota Credito','Nota Credito VIU'))BEGINSET @Renglones=(SELECT MAX(Renglon)/2048 FROM CxcD WHERE ID=@ID)WHILE @Iteracion<@RenglonesBEGINSET @Aplica=(SELECT Cxc.Origen FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)IF (@Aplica NOT IN ('Factura','Factura VIU','Factura Mayoreo','Cheque Devuelto','Prestamo','Endoso','Nota Cargo','Nota Cargo VIU','Nota Cargo Mayoreo','Incobrable Cuenta'))SET @Ok = 99994SET @Iteracion=@Iteracion+1ENDENDELSE IF (@Mov IN ('Cancela Credilana','Cancela Prestamo'))BEGINSET @Renglones=(SELECT MAX(Renglon)/2048 FROM CxcD WHERE ID=@ID)WHILE @Iteracion<@RenglonesBEGINSET @Aplica=(SELECT Cxc.Origen FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)SET @AplicaID=(SELECT Cxc.OrigenID FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)IF (@Aplica='Documento')BEGINSET @Aplica=(SELECT Origen FROM Cxc WHERE Mov=@Aplica AND MovID=@AplicaID)IF (@Aplica NOT IN ('Credilana','Prestamos Personales'))SET @Ok = 99994ENDELSEBEGINIF (@Aplica NOT IN ('Credilana','Prestamos Personales'))SET @Ok = 99994ENDSET @Iteracion=@Iteracion+1ENDENDELSE IF (@Mov IN ('Cancela Seg Auto'))BEGINSET @Renglones=(SELECT MAX(Renglon)/2048 FROM CxcD WHERE ID=@ID)WHILE @Iteracion<@RenglonesBEGINSET @Aplica=(SELECT Cxc.Origen FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)SET @AplicaID=(SELECT Cxc.OrigenID FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)IF (@Aplica='Documento')BEGINSET @Aplica=(SELECT Origen FROM Cxc WHERE Mov=@Aplica AND MovID=@AplicaID)IF (@Aplica NOT IN ('Seguro Auto'))SET @Ok = 99994ENDELSEBEGINIF (@Aplica NOT IN ('Seguro Auto'))SET @Ok = 99994ENDSET @Iteracion=@Iteracion+1ENDENDELSE IF (@Mov IN ('Cancela Seg Vida'))BEGINSET @Renglones=(SELECT MAX(Renglon)/2048 FROM CxcD WHERE ID=@ID)WHILE @Iteracion<@RenglonesBEGINSET @Aplica=(SELECT Cxc.Origen FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)SET @AplicaID=(SELECT Cxc.OrigenID FROM Cxc, CxcD WHERE CxcD.ID=@ID AND CxcD.Renglon=(2048*(@Iteracion+1)) AND CxcD.Aplica=Cxc.Mov AND CxcD.AplicaID=Cxc.MovID)IF (@Aplica='Documento')BEGINSET @Aplica=(SELECT Origen FROM Cxc WHERE Mov=@Aplica AND MovID=@AplicaID)IF (@Aplica NOT IN ('Seguro Vida'))SET @Ok = 99994ENDBEGINIF (@Aplica NOT IN ('Seguro Vida'))SET @Ok = 99994ENDSET @Iteracion=@Iteracion+1ENDENDRETURNENDGO